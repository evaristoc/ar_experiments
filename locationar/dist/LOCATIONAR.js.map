{"version":3,"sources":["webpack://LOCATIONAR/webpack/universalModuleDefinition","webpack://LOCATIONAR/webpack/bootstrap","webpack://LOCATIONAR/./src/GeoMath.ts","webpack://LOCATIONAR/./src/math/Vector3.ts","webpack://LOCATIONAR/./src/GpsLocation.ts","webpack://LOCATIONAR/./src/LOCATIONAR.ts","webpack://LOCATIONAR/./src/Source.ts","webpack://LOCATIONAR/./src/LocationProvider.ts","webpack://LOCATIONAR/./src/DirectionProvider.ts","webpack://LOCATIONAR/./src/math/Quaternion.js","webpack://LOCATIONAR/./src/BrightnessProvider.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Vector3_1","GeoUtil","setDefault","def","undefined","GeoMath","degToRad","deg","radToDeg","rad","limit","min","max","Math","getFlatCoordDistance","pos1","pos2","dLat","this","x","dLon","z","a","sin","cos","atan2","sqrt","EARTHRADIUS","coordTo3dSpace","gpsPosition","gpsZero","dAlt","y","coordOffsetGpsSpace","localOffset","interpolate","point1","point2","lastPoint","now","p1","pos","p2","progress","time","p0","Vector3","PI","GeoMath_1","GpsLocation","position","Source_1","Source","LocationProvider_1","LocationProvider","DirectionProvider_1","DirectionProvider","BrightnessProvider_1","BrightnessProvider","GpsLocation_1","parameters","_this","largeScreenSize","innerWidth","innerHeight","devicePixelRatio","smallScreenSize","parent","document","body","canvas","onResize","camera","deviceId","facingMode","sourceWidth","sourceHeight","setParameters","console","info","source","rendererDom","onResizeElement","copyElementSizeTo","that","initialize","then","params","stream","domElement","aspect","updateProjectionMatrix","addEventListener","Promise","resolve","reject","webcam","_initSourceWebcam","appendChild","message","positionSourceDomElement","dispose","removeChild","screenWidth","screenHeight","videoWidth","videoHeight","sourceAspect","newWidth","style","width","marginLeft","height","marginTop","newHeight","warn","otherElement","parseInt","onReady","onError","createElement","setAttribute","navigator","mediaDevices","enumerateDevices","getUserMedia","fctName","devices","userMediaConstraints","audio","video","ideal","resizeMode","aspectRatio","exact","srcObject","play","event","catch","error","top","left","zIndex","newValue","default","localPosition","useGpsAltitude","lastPositionArrived","Date","lastPositionTimestamp","gpsOptions","enableHighAccuracy","maximumAge","timeout","Infinity","cameraHeight","callback","locationProvider","geolocation","watchID","watchPosition","updatePosition","onLocationError","getLocation","getDebug","timestamp","coords","latitude","longitude","altitude","gps","positionRaw","position0","position1","position2","clearWatch","setCameraHeight","setGpsZero","code","PERMISSION_DENIED","POSITION_UNAVAILABLE","TIMEOUT","Quaternion_1","alphaOffset","enabled","debug","alpha","beta","gamma","absolute","quaternion","Quaternion","screenOrientation","zee","q0","q1","directionProvider","scope","onDeviceOrientationChangeEvent","updateDeviceOrientation","onScreenOrientationChangeEvent","orientation","connect","getDirection","device","webkitCompassHeading","webkitCompassAccuracy","orient","setObjectQuaternion","quaternionFromOrientation","disconnect","quanternion","setFromEuler","multiply","setFromAxisAngle","targetQuanternion","angle","abs","dot","slerp","type","removeEventListener","sensor","stop","w","_x","_y","_z","_w","__webpack_exports__","assign","qa","qb","qm","copy","slerpFlat","dst","dstOffset","src0","srcOffset0","src1","srcOffset1","x0","y0","z0","w0","x1","y1","z1","w1","dir","sqrSin","Number","EPSILON","len","tDir","f","defineProperties","set","_onChangeCallback","isQuaternion","clone","constructor","euler","order","c1","c2","c3","s1","s2","s3","axis","halfAngle","setFromRotationMatrix","te","elements","m11","m12","m13","m21","m22","m23","m31","m32","m33","trace","setFromUnitVectors","vFrom","vTo","normalize","angleTo","q","acos","rotateTowards","step","inverse","conjugate","v","lengthSq","length","multiplyQuaternions","premultiply","b","qax","qay","qaz","qaw","qbx","qby","qbz","qbw","cosHalfTheta","sqrSinHalfTheta","sinHalfTheta","halfTheta","ratioA","ratioB","equals","fromArray","array","offset","toArray","_onChange","illuminance","avalible","luxProvider","permissions","query","result","state","AmbientLightSensor","onerror","onSensorError","onreading","start","isAvalible","getIlluminance","getBrightness","log","LN10","getLightPower"],"mappings":"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","file":"LOCATIONAR.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"LOCATIONAR\"] = factory();\n\telse\n\t\troot[\"LOCATIONAR\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","import { Vector3 } from \"./math/Vector3\";\r\n\r\nexport interface Vector3Type {\r\n\tx: number;\r\n\ty: number;\r\n\tz: number;\r\n}\r\n\r\nexport interface QuaternionType {\r\n\tx: number;\r\n\ty: number;\r\n\tz: number;\r\n\tw: number;\r\n}\r\n\r\nexport class GeoUtil {\r\n\tpublic static setDefault = <T>(value: T | undefined, def: T): T => {\r\n\t\tif (value !== undefined) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\treturn def;\r\n\t};\r\n}\r\n\r\n// tslint:disable: max-classes-per-file\r\nexport class GeoMath {\r\n\tpublic static EARTHRADIUS = 6371000.0; // m\r\n\tpublic static PI = 3.1415926535897932;\r\n\r\n\tpublic static degToRad(deg: number): number {\r\n\t\treturn 0.0174532925199432 * deg; // (deg / 180) * Math.PI\r\n\t}\r\n\r\n\tpublic static radToDeg(rad: number): number {\r\n\t\treturn 57.29577951308232 * rad; // (rad / Math.PI) * 180\r\n\t}\r\n\r\n\tpublic static limit(value: number, min: number, max: number): number {\r\n\t\treturn Math.max(Math.min(value, max), min);\r\n\t}\r\n\r\n\tpublic static getFlatCoordDistance(pos1: Vector3Type, pos2: Vector3Type): number {\r\n\t\tconst dLat = this.degToRad(pos2.x - pos1.x);\r\n\t\tconst dLon = this.degToRad(pos2.z - pos1.z);\r\n\r\n\t\tconst a =\r\n\t\t\tMath.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n\t\t\tMath.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(pos1.x) * Math.cos(pos2.x);\r\n\r\n\t\tconst c = Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\r\n\t\treturn 2 * GeoMath.EARTHRADIUS * c;\r\n\t}\r\n\r\n\t// lat[Latitude] North/South\r\n\t// lon[Longitude] West/East\r\n\r\n\tpublic static coordTo3dSpace(gpsPosition: Vector3Type, gpsZero: Vector3Type): Vector3Type {\r\n\t\t// only approx, small distances http://www.movable-type.co.uk/scripts/latlong.html\r\n\r\n\t\tconst dLat = this.degToRad(gpsPosition.x - gpsZero.x);\r\n\t\tconst dLon = this.degToRad(gpsPosition.z - gpsZero.z);\r\n\t\tconst dAlt = gpsPosition.y - gpsZero.y;\r\n\r\n\t\tconst distLat = GeoMath.EARTHRADIUS * dLat;\r\n\t\tconst distLon = GeoMath.EARTHRADIUS * dLon * Math.cos(this.degToRad(gpsZero.x));\r\n\r\n\t\treturn { x: -distLat, y: dAlt, z: distLon };\r\n\t}\r\n\r\n\tpublic static coordOffsetGpsSpace(\r\n\t\tgpsPosition: Vector3Type,\r\n\t\tlocalOffset: Vector3Type\r\n\t): Vector3Type {\r\n\t\t// only approx, small distances http://www.movable-type.co.uk/scripts/latlong.html\r\n\r\n\t\tconst dLat = localOffset.x / GeoMath.EARTHRADIUS;\r\n\t\tconst dLon = localOffset.z / Math.cos(this.degToRad(gpsPosition.x)) / GeoMath.EARTHRADIUS;\r\n\t\tconst dAlt = gpsPosition.y + localOffset.y;\r\n\r\n\t\treturn {\r\n\t\t\tx: gpsPosition.x + this.radToDeg(dLat),\r\n\t\t\ty: dAlt,\r\n\t\t\tz: gpsPosition.z + this.radToDeg(dLon)\r\n\t\t};\r\n\t}\r\n\r\n\tpublic static interpolate(\r\n\t\tpoint1: { time: number; pos: Vector3Type },\r\n\t\tpoint2: { time: number; pos: Vector3Type },\r\n\t\tlastPoint: number,\r\n\t\tnow: number\r\n\t) {\r\n\t\tconst p1 = point1.pos;\r\n\t\tconst p2 = point2.pos;\r\n\t\tconst progress = GeoMath.limit((now - lastPoint) / (point2.time - point1.time), 0, 1);\r\n\r\n\t\tconst p0 = new Vector3();\r\n\t\tp0.x = p1.x + (p2.x - p1.x) * progress;\r\n\t\tp0.y = p1.y + (p2.y - p1.y) * progress;\r\n\t\tp0.z = p1.z + (p2.z - p1.z) * progress;\r\n\t\treturn p0;\r\n\t}\r\n}\r\n","import { Vector3Type } from \"../GeoMath\";\r\n\r\nexport class Vector3 implements Vector3Type {\r\n\tpublic x: number;\r\n\tpublic y: number;\r\n\tpublic z: number;\r\n\r\n\tconstructor(x: number = 0, y: number = 0, z: number = 0) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n\t}\r\n}\r\n","import { GeoMath, Vector3Type } from \"./GeoMath\";\r\n\r\nexport class GpsLocation implements Vector3Type {\r\n\tpublic x: number;\r\n\tpublic y: number;\r\n\tpublic z: number;\r\n\r\n\tconstructor(gpsPosition: Vector3Type, gpsZero: Vector3Type) {\r\n\t\tconst position = GeoMath.coordTo3dSpace(gpsPosition, gpsZero);\r\n\t\tthis.x = position.x;\r\n\t\tthis.y = position.y;\r\n\t\tthis.z = position.z;\r\n\t}\r\n}\r\n","import { Source } from \"./Source\";\r\nimport { LocationProvider } from \"./LocationProvider\";\r\nimport { DirectionProvider } from \"./DirectionProvider\";\r\nimport { BrightnessProvider } from \"./BrightnessProvider\";\r\nimport { GpsLocation } from \"./GpsLocation\";\r\nimport { GeoMath } from \"./GeoMath\";\r\n\r\nexport { Source, LocationProvider, DirectionProvider, BrightnessProvider, GpsLocation, GeoMath };\r\n","/**\r\n * @author JamesMilner / https://github.com/JamesMilnerUK\r\n * @author 0x4d\r\n */\r\n\r\nexport interface SourceParameters {\r\n\tparent: HTMLElement;\r\n\tcanvas: HTMLElement | null; // 0x4d\r\n\tonResize: ((source: Source, rendererDom: HTMLElement | null) => void) | null;\r\n\tcamera: { aspect: number; updateProjectionMatrix: () => void } | null;\r\n\tfacingMode: \"user\" | \"environment\";\r\n\tdeviceId: any;\r\n\tsourceWidth: number;\r\n\tsourceHeight: number;\r\n\t// displayWidth: number;\r\n\t// displayHeight: number;\r\n}\r\n\r\nexport class Source {\r\n\tpublic domElement: HTMLVideoElement | undefined;\r\n\tprivate parameters: SourceParameters;\r\n\tprivate stream: MediaStream | undefined;\r\n\r\n\tconstructor(parameters: Partial<SourceParameters>) {\r\n\t\t// handle default parameters\r\n\r\n\t\tconst largeScreenSize =\r\n\t\t\tMath.max(window.innerWidth, window.innerHeight) * window.devicePixelRatio;\r\n\r\n\t\tconst smallScreenSize = (largeScreenSize / 4) * 3;\r\n\r\n\t\tthis.parameters = {\r\n\t\t\tparent: document.body,\r\n\t\t\tcanvas: null, // 0x4d\r\n\t\t\tonResize: null,\r\n\t\t\tcamera: null,\r\n\r\n\t\t\t// Device id of the camera to use (optional)\r\n\t\t\tdeviceId: null,\r\n\t\t\tfacingMode: \"environment\",\r\n\r\n\t\t\t// resolution of at which we initialize in the source image\r\n\t\t\tsourceWidth: largeScreenSize, // 640\r\n\t\t\tsourceHeight: smallScreenSize // 480,\r\n\t\t\t// resolution displayed for the source\r\n\t\t\t// displayWidth: 640,\r\n\t\t\t// displayHeight: 480\r\n\t\t};\r\n\r\n\t\tthis.setParameters(parameters);\r\n\r\n\t\tif (this.parameters.canvas === undefined) {\r\n\t\t\tconsole.info(\"canvas have to be provided, otherwise resize won't work\");\r\n\t\t}\r\n\r\n\t\tif (!this.parameters.onResize) {\r\n\t\t\tthis.parameters.onResize = (source: Source, rendererDom: HTMLElement | null) => {\r\n\t\t\t\tsource.onResizeElement();\r\n\t\t\t\tif (rendererDom && rendererDom !== null) {\r\n\t\t\t\t\tsource.copyElementSizeTo(rendererDom);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tconst that = this;\r\n\t\tthis.initialize().then(() => {\r\n\t\t\tconst params = that.parameters;\r\n\t\t\tif (params.camera !== null && this.stream && this.domElement) {\r\n\t\t\t\t// this.stream.getVideoTracks()[0].getSettings().aspectRatio;\r\n\t\t\t\t// doesn't really work, for now we only have a video resolution of 4/3\r\n\t\t\t\tparams.camera.aspect = 4 / 3;\r\n\t\t\t\tparams.camera.updateProjectionMatrix();\r\n\t\t\t}\r\n\r\n\t\t\twindow.addEventListener(\"resize\", () => {\r\n\t\t\t\tif (params.onResize) {\r\n\t\t\t\t\tparams.onResize(that, params.canvas);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (params.onResize) {\r\n\t\t\t\tparams.onResize(that, params.canvas);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tpublic initialize() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst onReady = () => {\r\n\t\t\t\tif (!this.domElement) {\r\n\t\t\t\t\treject(\"domElement not defined\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.onResizeElement();\r\n\t\t\t\tthis.parameters.parent.appendChild(this.domElement);\r\n\t\t\t\tresolve();\r\n\t\t\t};\r\n\r\n\t\t\tconst onError = (message: Error | string) => {\r\n\t\t\t\treject(message);\r\n\t\t\t};\r\n\r\n\t\t\tconst webcam = this._initSourceWebcam(onReady, onError);\r\n\t\t\tif (!webcam) {\r\n\t\t\t\treject(\"Webcam source could not be established\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.domElement = webcam;\r\n\r\n\t\t\tthis.positionSourceDomElement();\r\n\r\n\t\t\treturn this;\r\n\t\t});\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\t\tif (this.parameters.parent && this.domElement) {\r\n\t\t\tthis.parameters.parent.removeChild(this.domElement);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic onResizeElement() {\r\n\t\tif (!this.domElement) {\r\n\t\t\tconsole.warn(\"Can't resize as domElement is not defined on source\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst screenWidth = window.innerWidth;\r\n\t\tconst screenHeight = window.innerHeight;\r\n\t\tlet sourceHeight = 0;\r\n\t\tlet sourceWidth = 0;\r\n\r\n\t\t// compute sourceWidth, sourceHeight\r\n\t\tif (this.domElement) {\r\n\t\t\tsourceWidth = this.domElement.videoWidth;\r\n\t\t\tsourceHeight = this.domElement.videoHeight;\r\n\t\t}\r\n\r\n\t\t// compute sourceAspect\r\n\t\tconst sourceAspect = sourceWidth / sourceHeight;\r\n\t\t// compute screenAspect\r\n\t\tconst screenAspect = screenWidth / screenHeight;\r\n\r\n\t\t// if screenAspect < sourceAspect, then change the width, else change the height\r\n\t\tif (screenAspect < sourceAspect) {\r\n\t\t\t// compute newWidth and set .width/.marginLeft\r\n\t\t\tconst newWidth = sourceAspect * screenHeight;\r\n\t\t\tthis.domElement.style.width = newWidth + \"px\";\r\n\t\t\tthis.domElement.style.marginLeft = -(newWidth - screenWidth) / 2 + \"px\";\r\n\r\n\t\t\t// init style.height/.marginTop to normal value\r\n\t\t\tthis.domElement.style.height = screenHeight + \"px\";\r\n\t\t\tthis.domElement.style.marginTop = \"0px\";\r\n\t\t} else {\r\n\t\t\t// compute newHeight and set .height/.marginTop\r\n\t\t\tconst newHeight = 1 / (sourceAspect / screenWidth);\r\n\t\t\tthis.domElement.style.height = newHeight + \"px\";\r\n\t\t\tthis.domElement.style.marginTop = -(newHeight - screenHeight) / 2 + \"px\";\r\n\r\n\t\t\t// init style.width/.marginLeft to normal value\r\n\t\t\tthis.domElement.style.width = screenWidth + \"px\";\r\n\t\t\tthis.domElement.style.marginLeft = \"0px\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Copy the dimensions of the domElement of the source to another given domElement\r\n\t * @param otherElement the target element to copy the size to, from the Source dom element\r\n\t */\r\n\tpublic copyElementSizeTo(otherElement: HTMLElement) {\r\n\t\tif (!this.domElement) {\r\n\t\t\tconsole.warn(\"Cant set size to match domElement as it is not defined\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (window.innerWidth > window.innerHeight) {\r\n\t\t\t// landscape\r\n\t\t\totherElement.style.width = this.domElement.style.width;\r\n\t\t\totherElement.style.height = this.domElement.style.height;\r\n\t\t\totherElement.style.marginLeft = this.domElement.style.marginLeft;\r\n\t\t\totherElement.style.marginTop = this.domElement.style.marginTop;\r\n\t\t} else {\r\n\t\t\t// portrait\r\n\t\t\totherElement.style.height = this.domElement.style.height;\r\n\t\t\totherElement.style.width = (parseInt(otherElement.style.height as string, 10) * 4) / 3 + \"px\"; // ! as string\r\n\t\t\totherElement.style.marginLeft =\r\n\t\t\t\t(window.innerWidth - parseInt(otherElement.style.width, 10)) / 2 + \"px\";\r\n\t\t\totherElement.style.marginTop = \"0\";\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _initSourceWebcam(onReady: () => any, onError: (message: string) => any) {\r\n\t\tconst domElement = document.createElement(\"video\");\r\n\t\tdomElement.setAttribute(\"autoplay\", \"\");\r\n\t\tdomElement.setAttribute(\"muted\", \"\");\r\n\t\tdomElement.setAttribute(\"playsinline\", \"\");\r\n\t\t// domElement.style.width = this.parameters.displayWidth + \"px\";\r\n\t\t// domElement.style.height = this.parameters.displayHeight + \"px\";\r\n\r\n\t\t// check API is available\r\n\t\tif (\r\n\t\t\tnavigator.mediaDevices === undefined ||\r\n\t\t\tnavigator.mediaDevices.enumerateDevices === undefined ||\r\n\t\t\tnavigator.mediaDevices.getUserMedia === undefined\r\n\t\t) {\r\n\t\t\tlet fctName = \"\";\r\n\t\t\tif (navigator.mediaDevices === undefined) {\r\n\t\t\t\tfctName = \"navigator.mediaDevices\";\r\n\t\t\t} else if (navigator.mediaDevices.enumerateDevices === undefined) {\r\n\t\t\t\tfctName = \"navigator.mediaDevices.enumerateDevices\";\r\n\t\t\t} else if (navigator.mediaDevices.getUserMedia === undefined) {\r\n\t\t\t\tfctName = \"navigator.mediaDevices.getUserMedia\";\r\n\t\t\t}\r\n\t\t\tonError(\"WebRTC issue-! \" + fctName + \" not present in your browser\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst that = this;\r\n\r\n\t\t// get available devices\r\n\t\tnavigator.mediaDevices\r\n\t\t\t.enumerateDevices()\r\n\t\t\t.then(devices => {\r\n\t\t\t\tconst userMediaConstraints = {\r\n\t\t\t\t\taudio: false,\r\n\t\t\t\t\tvideo: {\r\n\t\t\t\t\t\tfacingMode: this.parameters.facingMode,\r\n\t\t\t\t\t\twidth: {\r\n\t\t\t\t\t\t\tideal: this.parameters.sourceWidth\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\theight: {\r\n\t\t\t\t\t\t\tideal: this.parameters.sourceHeight\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tresizeMode: \"none\",\r\n\t\t\t\t\t\taspectRatio: { ideal: 4 / 3 }\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (null !== this.parameters.deviceId) {\r\n\t\t\t\t\t(userMediaConstraints as any).video.deviceId = {\r\n\t\t\t\t\t\texact: this.parameters.deviceId\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// get a device which satisfy the constraints\r\n\t\t\t\tnavigator.mediaDevices\r\n\t\t\t\t\t.getUserMedia(userMediaConstraints)\r\n\t\t\t\t\t.then(function success(stream) {\r\n\t\t\t\t\t\t// set the .src of the domElement\r\n\t\t\t\t\t\tthat.stream = stream;\r\n\t\t\t\t\t\tdomElement.srcObject = stream;\r\n\t\t\t\t\t\t// to start the video, when it is possible to start it only on userevent. like in android\r\n\t\t\t\t\t\tdocument.body.addEventListener(\"click\", () => {\r\n\t\t\t\t\t\t\tdomElement.play();\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tdomElement.addEventListener(\"loadedmetadata\", event => {\r\n\t\t\t\t\t\t\tonReady();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(error => {\r\n\t\t\t\t\t\tonError(error);\r\n\t\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(error => {\r\n\t\t\t\tonError(error);\r\n\t\t\t});\r\n\r\n\t\treturn domElement;\r\n\t}\r\n\r\n\tprivate positionSourceDomElement() {\r\n\t\tif (this.domElement) {\r\n\t\t\tthis.domElement.style.position = \"absolute\";\r\n\t\t\tthis.domElement.style.top = \"0px\";\r\n\t\t\tthis.domElement.style.left = \"0px\";\r\n\t\t\tthis.domElement.style.zIndex = \"-1\";\r\n\t\t}\r\n\t}\r\n\r\n\tprivate setParameters(parameters: any) {\r\n\t\tif (!parameters) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (const key in parameters) {\r\n\t\t\tif (key) {\r\n\t\t\t\tconst newValue = parameters[key];\r\n\r\n\t\t\t\tif (newValue === undefined) {\r\n\t\t\t\t\tconsole.warn(key + \"' parameter is undefined.\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst currentValue = (this.parameters as any)[key];\r\n\r\n\t\t\t\tif (currentValue === undefined) {\r\n\t\t\t\t\tconsole.warn(key + \"' is not a property of this Source.\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t(this.parameters as any)[key] = newValue;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default Source;\r\n","import { GpsLocation } from \"./GpsLocation\";\r\nimport { GeoMath, GeoUtil, Vector3Type } from \"./GeoMath\";\r\nimport { Vector3 } from \"./math/Vector3\";\r\n\r\nexport class LocationProvider {\r\n\tprivate localPosition: Vector3Type = new Vector3();\r\n\tprivate callback: (locationProvider: LocationProvider) => void;\r\n\r\n\tprivate cameraHeight: number;\r\n\tprivate gpsZero: Vector3Type = new Vector3();\r\n\tprivate useGpsAltitude: boolean = false;\r\n\r\n\tprivate lastPositionArrived: number = Date.now();\r\n\tprivate position1: { time: number; pos: Vector3Type } | undefined;\r\n\tprivate position2: { time: number; pos: Vector3Type } | undefined;\r\n\r\n\tprivate lastPositionTimestamp: number = 0;\r\n\tprivate gpsPosition: Position | undefined;\r\n\r\n\tprivate watchID: number | undefined;\r\n\tprivate gpsOptions = {\r\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/PositionOptions\r\n\t\tenableHighAccuracy: true,\r\n\t\tmaximumAge: 0,\r\n\t\ttimeout: Infinity\r\n\t};\r\n\r\n\tconstructor(params: {\r\n\t\tcallback: (locationProvider: LocationProvider) => void;\r\n\t\tgpsZero: Vector3Type;\r\n\t\tcameraHeight?: number;\r\n\t\tuseGpsAltitude?: boolean;\r\n\t}) {\r\n\t\tthis.gpsZero = params.gpsZero;\r\n\t\tthis.cameraHeight = GeoUtil.setDefault<number>(params.cameraHeight, 1.6);\r\n\t\tthis.useGpsAltitude = GeoUtil.setDefault<boolean>(params.useGpsAltitude, false);\r\n\t\tthis.callback = GeoUtil.setDefault<(locationProvider: LocationProvider) => void>(\r\n\t\t\tparams.callback,\r\n\t\t\tlocationProvider => undefined\r\n\t\t);\r\n\r\n\t\tif (!this.gpsZero) {\r\n\t\t\tconsole.info(\"gpsZero is required\");\r\n\t\t\tthis.gpsZero = new Vector3();\r\n\t\t}\r\n\r\n\t\t// TODO Permission Api\r\n\r\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API\r\n\t\tif (!navigator.geolocation) {\r\n\t\t\tconsole.info(\"Geolocation is not supported by your browser\");\r\n\t\t} else {\r\n\t\t\tconst success = (position: Position) => {\r\n\t\t\t\tthis.gpsPosition = position;\r\n\t\t\t\tthis.updatePosition();\r\n\t\t\t};\r\n\t\t\tthis.watchID = navigator.geolocation.watchPosition(\r\n\t\t\t\tsuccess,\r\n\t\t\t\terror => this.onLocationError(error, console.info),\r\n\t\t\t\tthis.gpsOptions\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getLocation() {\r\n\t\treturn this.localPosition;\r\n\t}\r\n\r\n\tpublic getDebug() {\r\n\t\treturn this.gpsPosition;\r\n\t}\r\n\r\n\tpublic updatePosition() {\r\n\t\tif (this.gpsPosition) {\r\n\t\t\tif (this.gpsPosition.timestamp !== this.lastPositionTimestamp) {\r\n\t\t\t\tconst coords = this.gpsPosition.coords;\r\n\t\t\t\tif (coords.latitude && coords.longitude) {\r\n\t\t\t\t\tconst altitude = coords.altitude ? coords.altitude : 0; // TODO not all positions contain altitude\r\n\t\t\t\t\tconst height = this.useGpsAltitude && coords.altitude ? altitude : this.cameraHeight;\r\n\t\t\t\t\tconst gps = new Vector3(coords.latitude, height, coords.longitude);\r\n\t\t\t\t\tconst positionRaw = new GpsLocation(gps, this.gpsZero);\r\n\t\t\t\t\tconst position0 = new Vector3(-positionRaw.x, positionRaw.y, positionRaw.z);\r\n\r\n\t\t\t\t\tthis.lastPositionTimestamp = this.gpsPosition.timestamp;\r\n\t\t\t\t\tthis.lastPositionArrived = Date.now();\r\n\r\n\t\t\t\t\tthis.position1 = this.position2;\r\n\t\t\t\t\tthis.position2 = { pos: position0, time: this.gpsPosition.timestamp };\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.position1 !== undefined && this.position2 !== undefined) {\r\n\t\t\tthis.localPosition = GeoMath.interpolate(\r\n\t\t\t\tthis.position1,\r\n\t\t\t\tthis.position2,\r\n\t\t\t\tthis.lastPositionArrived,\r\n\t\t\t\tDate.now()\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tthis.callback(this);\r\n\t\treturn this.localPosition;\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\t\tif (this.watchID) {\r\n\t\t\tnavigator.geolocation.clearWatch(this.watchID);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic setCameraHeight(height: number) {\r\n\t\tthis.cameraHeight = height;\r\n\t}\r\n\r\n\tpublic setGpsZero(gpsZero: Vector3Type) {\r\n\t\tthis.gpsZero = gpsZero;\r\n\t}\r\n\r\n\tprivate onLocationError(error: PositionError, onError: (error: string) => void) {\r\n\t\tswitch (error.code) {\r\n\t\t\tcase error.PERMISSION_DENIED: // Error message when user denied permission to use Geolocation\r\n\t\t\t\tonError(\"User denied permission for Geolocation\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase error.POSITION_UNAVAILABLE: // Error message for when the position is unavailable\r\n\t\t\t\tonError(\"Location information is unavailable\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase error.TIMEOUT: // Error message when there occurs a time out\r\n\t\t\t\tonError(\"The request to get user location timedout\");\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow error; // Error message when the error is unknown\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @author richt / http://richt.me\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author 0x4d / https://github.com/0b01001101\r\n *\r\n * W3C Device Orientation control (http://w3c.github.io/deviceorientation/spec-source-orientation.html)\r\n */\r\n\r\nimport { GeoMath, GeoUtil } from \"./GeoMath\";\r\n\r\nimport { Quaternion } from \"./math/Quaternion\";\r\nimport { Vector3 } from \"./math/Vector3\";\r\n\r\nexport class DirectionProvider {\r\n\tprivate alphaOffset = GeoMath.degToRad(-90); // radians\r\n\r\n\tprivate enabled = true;\r\n\tprivate debug = { alpha: 0, beta: 0, gamma: 0, absolute: false };\r\n\r\n\tprivate quaternion = new Quaternion();\r\n\r\n\tprivate screenOrientation = 0;\r\n\r\n\tprivate zee = new Vector3(0, 0, 1);\r\n\tprivate q0 = new Quaternion();\r\n\tprivate q1 = new Quaternion(-Math.sqrt(0.5), 0, 0, Math.sqrt(0.5)); // - PI/2 around the x-axis\r\n\r\n\tprivate onDeviceOrientationChangeEvent: (event: any) => void;\r\n\tprivate onScreenOrientationChangeEvent: () => void;\r\n\tprivate sensor: any | undefined;\r\n\tprivate callback: (directionProvider: DirectionProvider) => void;\r\n\r\n\tconstructor(params: { callback: (directionProvider: DirectionProvider) => void }) {\r\n\t\tthis.callback = GeoUtil.setDefault<(directionProvider: DirectionProvider) => void>(\r\n\t\t\tparams.callback,\r\n\t\t\tdirectionProvider => undefined\r\n\t\t);\r\n\r\n\t\tconst scope = this;\r\n\r\n\t\tthis.onDeviceOrientationChangeEvent = event => {\r\n\t\t\tscope.updateDeviceOrientation(event);\r\n\t\t};\r\n\r\n\t\tthis.onScreenOrientationChangeEvent = () => {\r\n\t\t\tscope.screenOrientation = (window.orientation as number) || 0; // deprecated soon https://developer.mozilla.org/en-US/docs/Web/API/Window/orientation\r\n\t\t};\r\n\r\n\t\tthis.connect();\r\n\t}\r\n\r\n\tpublic getDirection() {\r\n\t\treturn this.quaternion;\r\n\t}\r\n\r\n\tpublic getDebug() {\r\n\t\treturn this.debug;\r\n\t}\r\n\r\n\tpublic updateDeviceOrientation(\r\n\t\tdevice: DeviceOrientationEvent & {\r\n\t\t\twebkitCompassHeading?: number;\r\n\t\t\twebkitCompassAccuracy?: number;\r\n\t\t}\r\n\t) {\r\n\t\tif (!this.enabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (device) {\r\n\t\t\tlet absolute = device.absolute;\r\n\t\t\tlet alpha = device.alpha ? GeoMath.degToRad(device.alpha) : 0; // Z\r\n\t\t\tconst beta = device.beta ? GeoMath.degToRad(device.beta) : 0; // X'\r\n\t\t\tconst gamma = device.gamma ? GeoMath.degToRad(device.gamma) : 0; // Y''\r\n\r\n\t\t\t// Safari\r\n\t\t\t// https://developer.apple.com/documentation/webkitjs/deviceorientationevent/1804777-webkitcompassheading\r\n\t\t\tif (absolute === false && device.webkitCompassHeading && device.webkitCompassAccuracy) {\r\n\t\t\t\tif (device.webkitCompassAccuracy > 0 && device.webkitCompassAccuracy < 50) {\r\n\t\t\t\t\tif (device.webkitCompassHeading > 0) {\r\n\t\t\t\t\t\talpha = device.webkitCompassHeading;\r\n\t\t\t\t\t\tabsolute = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\talpha = (alpha + 360) % 360; // if alpha < 0 or > 360\r\n\r\n\t\t\tthis.debug = { alpha, beta, gamma, absolute };\r\n\r\n\t\t\tconst orient = this.screenOrientation ? GeoMath.degToRad(this.screenOrientation) : 0; // O\r\n\r\n\t\t\tthis.setObjectQuaternion(\r\n\t\t\t\tthis.quaternionFromOrientation(alpha + this.alphaOffset, beta, gamma, orient)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\t\tthis.disconnect();\r\n\t}\r\n\r\n\t// The angles alpha, beta and gamma form a set of intrinsic Tait-Bryan angles of type Z-X'-Y''\r\n\tprivate quaternionFromOrientation(alpha: number, beta: number, gamma: number, orient: number) {\r\n\t\tconst quanternion = new Quaternion().setFromEuler(new Vector3(beta, alpha, -gamma), \"YXZ\"); // orient the device\r\n\t\tquanternion.multiply(this.q1); // camera looks out the back of the device, not the top\r\n\t\tquanternion.multiply(this.q0.setFromAxisAngle(this.zee, -orient)); // adjust for screen orientation\r\n\t\treturn quanternion;\r\n\t}\r\n\r\n\tprivate setObjectQuaternion(targetQuanternion: Quaternion) {\r\n\t\tconst angle = 200 * (1 - Math.abs(targetQuanternion.dot(this.quaternion)));\r\n\t\tthis.quaternion.slerp(targetQuanternion, GeoMath.limit(angle, 0, 1));\r\n\t\tthis.callback(this);\r\n\t}\r\n\r\n\tprivate connect(type?: \"absoluteSensor\" | \"absoluteOrientation\" | \"deviceOrientation\") {\r\n\t\tthis.onScreenOrientationChangeEvent();\r\n\r\n\t\twindow.addEventListener(\"orientationchange\", this.onScreenOrientationChangeEvent, false);\r\n\r\n\t\t// TODO Support other absolute deviceorientationevents [only supported in chrome?]\r\n\t\t// TODO AbsoluteOrientationSensor, compass.js, ...\r\n\t\t// https://gist.github.com/DroopyTersen/65c9fccd08830ab61e08\r\n\r\n\t\t// const that = this;\r\n\r\n\t\t/*if (\"AbsoluteOrientationSensor\" in window && (!type || type === \"absoluteSensor\")) {\r\n\t\t\tthat.checkPermission(that.initSensor);\r\n\t\t} else*/ if (\r\n\t\t\t\"ondeviceorientationabsolute\" in window &&\r\n\t\t\t(!type || type === \"absoluteOrientation\")\r\n\t\t) {\r\n\t\t\t// Chrome\r\n\t\t\t(window as any).addEventListener(\r\n\t\t\t\t\"deviceorientationabsolute\",\r\n\t\t\t\tthis.onDeviceOrientationChangeEvent,\r\n\t\t\t\tfalse\r\n\t\t\t);\r\n\t\t} else if (\"ondeviceorientation\" in window && (!type || type === \"deviceOrientation\")) {\r\n\t\t\t// Non Chrome\r\n\t\t\t(window as any).addEventListener(\r\n\t\t\t\t\"deviceorientation\",\r\n\t\t\t\tthis.onDeviceOrientationChangeEvent,\r\n\t\t\t\tfalse\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tconsole.info(\"No Orientation sensors avalible\");\r\n\t\t}\r\n\r\n\t\tthis.enabled = true;\r\n\t}\r\n\r\n\t/*private checkPermission(initSensor: () => void) {\r\n\t\tif (navigator.permissions) {\r\n\t\t\t// https://w3c.github.io/orientation-sensor/#model\r\n\t\t\tPromise.all([\r\n\t\t\t\tnavigator.permissions.query({ name: \"accelerometer\" }),\r\n\t\t\t\tnavigator.permissions.query({ name: \"magnetometer\" }),\r\n\t\t\t\tnavigator.permissions.query({ name: \"gyroscope\" })\r\n\t\t\t])\r\n\t\t\t\t.then(results => {\r\n\t\t\t\t\tif (results.every(result => result.state === \"granted\")) {\r\n\t\t\t\t\t\tinitSensor();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// \"Permission to use sensor was denied.;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch(err => {\r\n\t\t\t\t\t// Integration with Permissions API is not enabled, still try to start app.\r\n\t\t\t\t\tinitSensor();\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\t// No Permissions API, still try to start app.;\r\n\t\t\tinitSensor();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate initSensor() {\r\n\t\tconst that = this;\r\n\t\tif (\"AbsoluteOrientationSensor\" in window) {\r\n\t\t\tconst options = { frequency: 60, referenceFrame: \"device\" };\r\n\r\n\t\t\t// @ts-ignore;\r\n\t\t\tthis.sensor = new AbsoluteOrientationSensor(options);\r\n\t\t\tthis.sensor.onreading = () => {\r\n\t\t\t\tthat.setObjectQuaternion(new Quaternion().fromArray(that.sensor.quaternion).inverse());\r\n\t\t\t};\r\n\t\t\tthis.sensor.onerror = (event: any) => {\r\n\t\t\t\tif (event.error.name === \"NotReadableError\") {\r\n\t\t\t\t\t// \"Sensor is not available.\";\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tthis.sensor.start();\r\n\t\t} else {\r\n\t\t\t// AbsoluteOrientationSensor not avalible\r\n\t\t}\r\n\t}*/\r\n\r\n\tprivate disconnect() {\r\n\t\twindow.removeEventListener(\"orientationchange\", this.onScreenOrientationChangeEvent, false);\r\n\r\n\t\tif (this.sensor) {\r\n\t\t\tthis.sensor.stop();\r\n\t\t}\r\n\r\n\t\tif (\"ondeviceorientationabsolute\" in window) {\r\n\t\t\t// Chrome\r\n\t\t\t(window as any).removeEventListener(\r\n\t\t\t\t\"deviceorientationabsolute\",\r\n\t\t\t\tthis.onDeviceOrientationChangeEvent,\r\n\t\t\t\tfalse\r\n\t\t\t);\r\n\t\t} else if (\"ondeviceorientation\" in window) {\r\n\t\t\t// Non Chrome\r\n\t\t\t(window as any).removeEventListener(\r\n\t\t\t\t\"deviceorientation\",\r\n\t\t\t\tthis.onDeviceOrientationChangeEvent,\r\n\t\t\t\tfalse\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tthis.enabled = false;\r\n\t}\r\n}\r\n","/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://clara.io\r\n */\r\n\r\n// import { _Math } from \"./Math.js\"; // 0x4d\r\n\r\nfunction Quaternion(x, y, z, w) {\r\n\tthis._x = x || 0;\r\n\tthis._y = y || 0;\r\n\tthis._z = z || 0;\r\n\tthis._w = w !== undefined ? w : 1;\r\n}\r\n\r\nObject.assign(Quaternion, {\r\n\tslerp: function(qa, qb, qm, t) {\r\n\t\treturn qm.copy(qa).slerp(qb, t);\r\n\t},\r\n\r\n\tslerpFlat: function(dst, dstOffset, src0, srcOffset0, src1, srcOffset1, t) {\r\n\t\t// fuzz-free, array-based Quaternion SLERP operation\r\n\r\n\t\tvar x0 = src0[srcOffset0 + 0],\r\n\t\t\ty0 = src0[srcOffset0 + 1],\r\n\t\t\tz0 = src0[srcOffset0 + 2],\r\n\t\t\tw0 = src0[srcOffset0 + 3],\r\n\t\t\tx1 = src1[srcOffset1 + 0],\r\n\t\t\ty1 = src1[srcOffset1 + 1],\r\n\t\t\tz1 = src1[srcOffset1 + 2],\r\n\t\t\tw1 = src1[srcOffset1 + 3];\r\n\r\n\t\tif (w0 !== w1 || x0 !== x1 || y0 !== y1 || z0 !== z1) {\r\n\t\t\tvar s = 1 - t,\r\n\t\t\t\tcos = x0 * x1 + y0 * y1 + z0 * z1 + w0 * w1,\r\n\t\t\t\tdir = cos >= 0 ? 1 : -1,\r\n\t\t\t\tsqrSin = 1 - cos * cos;\r\n\r\n\t\t\t// Skip the Slerp for tiny steps to avoid numeric problems:\r\n\t\t\tif (sqrSin > Number.EPSILON) {\r\n\t\t\t\tvar sin = Math.sqrt(sqrSin),\r\n\t\t\t\t\tlen = Math.atan2(sin, cos * dir);\r\n\r\n\t\t\t\ts = Math.sin(s * len) / sin;\r\n\t\t\t\tt = Math.sin(t * len) / sin;\r\n\t\t\t}\r\n\r\n\t\t\tvar tDir = t * dir;\r\n\r\n\t\t\tx0 = x0 * s + x1 * tDir;\r\n\t\t\ty0 = y0 * s + y1 * tDir;\r\n\t\t\tz0 = z0 * s + z1 * tDir;\r\n\t\t\tw0 = w0 * s + w1 * tDir;\r\n\r\n\t\t\t// Normalize in case we just did a lerp:\r\n\t\t\tif (s === 1 - t) {\r\n\t\t\t\tvar f = 1 / Math.sqrt(x0 * x0 + y0 * y0 + z0 * z0 + w0 * w0);\r\n\r\n\t\t\t\tx0 *= f;\r\n\t\t\t\ty0 *= f;\r\n\t\t\t\tz0 *= f;\r\n\t\t\t\tw0 *= f;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdst[dstOffset] = x0;\r\n\t\tdst[dstOffset + 1] = y0;\r\n\t\tdst[dstOffset + 2] = z0;\r\n\t\tdst[dstOffset + 3] = w0;\r\n\t}\r\n});\r\n\r\nObject.defineProperties(Quaternion.prototype, {\r\n\tx: {\r\n\t\tget: function() {\r\n\t\t\treturn this._x;\r\n\t\t},\r\n\r\n\t\tset: function(value) {\r\n\t\t\tthis._x = value;\r\n\t\t\tthis._onChangeCallback();\r\n\t\t}\r\n\t},\r\n\r\n\ty: {\r\n\t\tget: function() {\r\n\t\t\treturn this._y;\r\n\t\t},\r\n\r\n\t\tset: function(value) {\r\n\t\t\tthis._y = value;\r\n\t\t\tthis._onChangeCallback();\r\n\t\t}\r\n\t},\r\n\r\n\tz: {\r\n\t\tget: function() {\r\n\t\t\treturn this._z;\r\n\t\t},\r\n\r\n\t\tset: function(value) {\r\n\t\t\tthis._z = value;\r\n\t\t\tthis._onChangeCallback();\r\n\t\t}\r\n\t},\r\n\r\n\tw: {\r\n\t\tget: function() {\r\n\t\t\treturn this._w;\r\n\t\t},\r\n\r\n\t\tset: function(value) {\r\n\t\t\tthis._w = value;\r\n\t\t\tthis._onChangeCallback();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nObject.assign(Quaternion.prototype, {\r\n\tisQuaternion: true,\r\n\r\n\tset: function(x, y, z, w) {\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._w = w;\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclone: function() {\r\n\t\treturn new this.constructor(this._x, this._y, this._z, this._w);\r\n\t},\r\n\r\n\tcopy: function(quaternion) {\r\n\t\tthis._x = quaternion.x;\r\n\t\tthis._y = quaternion.y;\r\n\t\tthis._z = quaternion.z;\r\n\t\tthis._w = quaternion.w;\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetFromEuler: function(euler, order) {\r\n\t\t// 0x4d\r\n\t\tvar x = euler.x,\r\n\t\t\ty = euler.y,\r\n\t\t\tz = euler.z;\r\n\r\n\t\t// http://www.mathworks.com/matlabcentral/fileexchange/\r\n\t\t// \t20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/\r\n\t\t//\tcontent/SpinCalc.m\r\n\r\n\t\tvar cos = Math.cos;\r\n\t\tvar sin = Math.sin;\r\n\r\n\t\tvar c1 = cos(x / 2);\r\n\t\tvar c2 = cos(y / 2);\r\n\t\tvar c3 = cos(z / 2);\r\n\r\n\t\tvar s1 = sin(x / 2);\r\n\t\tvar s2 = sin(y / 2);\r\n\t\tvar s3 = sin(z / 2);\r\n\r\n\t\tif (order === \"XYZ\") {\r\n\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\t\t} else if (order === \"YXZ\") {\r\n\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\t\t} else if (order === \"ZXY\") {\r\n\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\t\t} else if (order === \"ZYX\") {\r\n\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\t\t} else if (order === \"YZX\") {\r\n\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\t\t} else if (order === \"XZY\") {\r\n\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\t\t}\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetFromAxisAngle: function(axis, angle) {\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm\r\n\r\n\t\t// assumes axis is normalized\r\n\r\n\t\tvar halfAngle = angle / 2,\r\n\t\t\ts = Math.sin(halfAngle);\r\n\r\n\t\tthis._x = axis.x * s;\r\n\t\tthis._y = axis.y * s;\r\n\t\tthis._z = axis.z * s;\r\n\t\tthis._w = Math.cos(halfAngle);\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetFromRotationMatrix: function(m) {\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\r\n\r\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n\t\tvar te = m.elements,\r\n\t\t\tm11 = te[0],\r\n\t\t\tm12 = te[4],\r\n\t\t\tm13 = te[8],\r\n\t\t\tm21 = te[1],\r\n\t\t\tm22 = te[5],\r\n\t\t\tm23 = te[9],\r\n\t\t\tm31 = te[2],\r\n\t\t\tm32 = te[6],\r\n\t\t\tm33 = te[10],\r\n\t\t\ttrace = m11 + m22 + m33,\r\n\t\t\ts;\r\n\r\n\t\tif (trace > 0) {\r\n\t\t\ts = 0.5 / Math.sqrt(trace + 1.0);\r\n\r\n\t\t\tthis._w = 0.25 / s;\r\n\t\t\tthis._x = (m32 - m23) * s;\r\n\t\t\tthis._y = (m13 - m31) * s;\r\n\t\t\tthis._z = (m21 - m12) * s;\r\n\t\t} else if (m11 > m22 && m11 > m33) {\r\n\t\t\ts = 2.0 * Math.sqrt(1.0 + m11 - m22 - m33);\r\n\r\n\t\t\tthis._w = (m32 - m23) / s;\r\n\t\t\tthis._x = 0.25 * s;\r\n\t\t\tthis._y = (m12 + m21) / s;\r\n\t\t\tthis._z = (m13 + m31) / s;\r\n\t\t} else if (m22 > m33) {\r\n\t\t\ts = 2.0 * Math.sqrt(1.0 + m22 - m11 - m33);\r\n\r\n\t\t\tthis._w = (m13 - m31) / s;\r\n\t\t\tthis._x = (m12 + m21) / s;\r\n\t\t\tthis._y = 0.25 * s;\r\n\t\t\tthis._z = (m23 + m32) / s;\r\n\t\t} else {\r\n\t\t\ts = 2.0 * Math.sqrt(1.0 + m33 - m11 - m22);\r\n\r\n\t\t\tthis._w = (m21 - m12) / s;\r\n\t\t\tthis._x = (m13 + m31) / s;\r\n\t\t\tthis._y = (m23 + m32) / s;\r\n\t\t\tthis._z = 0.25 * s;\r\n\t\t}\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetFromUnitVectors: function(vFrom, vTo) {\r\n\t\t// assumes direction vectors vFrom and vTo are normalized\r\n\r\n\t\tvar EPS = 0.000001;\r\n\r\n\t\tvar r = vFrom.dot(vTo) + 1;\r\n\r\n\t\tif (r < EPS) {\r\n\t\t\tr = 0;\r\n\r\n\t\t\tif (Math.abs(vFrom.x) > Math.abs(vFrom.z)) {\r\n\t\t\t\tthis._x = -vFrom.y;\r\n\t\t\t\tthis._y = vFrom.x;\r\n\t\t\t\tthis._z = 0;\r\n\t\t\t\tthis._w = r;\r\n\t\t\t} else {\r\n\t\t\t\tthis._x = 0;\r\n\t\t\t\tthis._y = -vFrom.z;\r\n\t\t\t\tthis._z = vFrom.y;\r\n\t\t\t\tthis._w = r;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// crossVectors( vFrom, vTo ); // inlined to avoid cyclic dependency on Vector3\r\n\r\n\t\t\tthis._x = vFrom.y * vTo.z - vFrom.z * vTo.y;\r\n\t\t\tthis._y = vFrom.z * vTo.x - vFrom.x * vTo.z;\r\n\t\t\tthis._z = vFrom.x * vTo.y - vFrom.y * vTo.x;\r\n\t\t\tthis._w = r;\r\n\t\t}\r\n\r\n\t\treturn this.normalize();\r\n\t},\r\n\r\n\tangleTo: function(q) {\r\n\t\treturn 2 * Math.acos(Math.abs(Math.max(Math.min(this.dot(q), 1), -1))); // 0x4d\r\n\t},\r\n\r\n\trotateTowards: function(q, step) {\r\n\t\tvar angle = this.angleTo(q);\r\n\r\n\t\tif (angle === 0) return this;\r\n\r\n\t\tvar t = Math.min(1, step / angle);\r\n\r\n\t\tthis.slerp(q, t);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tinverse: function() {\r\n\t\t// quaternion is assumed to have unit length\r\n\r\n\t\treturn this.conjugate();\r\n\t},\r\n\r\n\tconjugate: function() {\r\n\t\tthis._x *= -1;\r\n\t\tthis._y *= -1;\r\n\t\tthis._z *= -1;\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdot: function(v) {\r\n\t\treturn this._x * v._x + this._y * v._y + this._z * v._z + this._w * v._w;\r\n\t},\r\n\r\n\tlengthSq: function() {\r\n\t\treturn this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w;\r\n\t},\r\n\r\n\tlength: function() {\r\n\t\treturn Math.sqrt(this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w);\r\n\t},\r\n\r\n\tnormalize: function() {\r\n\t\tvar l = this.length();\r\n\r\n\t\tif (l === 0) {\r\n\t\t\tthis._x = 0;\r\n\t\t\tthis._y = 0;\r\n\t\t\tthis._z = 0;\r\n\t\t\tthis._w = 1;\r\n\t\t} else {\r\n\t\t\tl = 1 / l;\r\n\r\n\t\t\tthis._x = this._x * l;\r\n\t\t\tthis._y = this._y * l;\r\n\t\t\tthis._z = this._z * l;\r\n\t\t\tthis._w = this._w * l;\r\n\t\t}\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tmultiply: function(q, p) {\r\n\t\tif (p !== undefined) {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t\"THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.\"\r\n\t\t\t);\r\n\t\t\treturn this.multiplyQuaternions(q, p);\r\n\t\t}\r\n\r\n\t\treturn this.multiplyQuaternions(this, q);\r\n\t},\r\n\r\n\tpremultiply: function(q) {\r\n\t\treturn this.multiplyQuaternions(q, this);\r\n\t},\r\n\r\n\tmultiplyQuaternions: function(a, b) {\r\n\t\t// from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm\r\n\r\n\t\tvar qax = a._x,\r\n\t\t\tqay = a._y,\r\n\t\t\tqaz = a._z,\r\n\t\t\tqaw = a._w;\r\n\t\tvar qbx = b._x,\r\n\t\t\tqby = b._y,\r\n\t\t\tqbz = b._z,\r\n\t\t\tqbw = b._w;\r\n\r\n\t\tthis._x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\r\n\t\tthis._y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\r\n\t\tthis._z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\r\n\t\tthis._w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tslerp: function(qb, t) {\r\n\t\tif (t === 0) return this;\r\n\t\tif (t === 1) return this.copy(qb);\r\n\r\n\t\tvar x = this._x,\r\n\t\t\ty = this._y,\r\n\t\t\tz = this._z,\r\n\t\t\tw = this._w;\r\n\r\n\t\t// http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\r\n\r\n\t\tvar cosHalfTheta = w * qb._w + x * qb._x + y * qb._y + z * qb._z;\r\n\r\n\t\tif (cosHalfTheta < 0) {\r\n\t\t\tthis._w = -qb._w;\r\n\t\t\tthis._x = -qb._x;\r\n\t\t\tthis._y = -qb._y;\r\n\t\t\tthis._z = -qb._z;\r\n\r\n\t\t\tcosHalfTheta = -cosHalfTheta;\r\n\t\t} else {\r\n\t\t\tthis.copy(qb);\r\n\t\t}\r\n\r\n\t\tif (cosHalfTheta >= 1.0) {\r\n\t\t\tthis._w = w;\r\n\t\t\tthis._x = x;\r\n\t\t\tthis._y = y;\r\n\t\t\tthis._z = z;\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar sqrSinHalfTheta = 1.0 - cosHalfTheta * cosHalfTheta;\r\n\r\n\t\tif (sqrSinHalfTheta <= Number.EPSILON) {\r\n\t\t\tvar s = 1 - t;\r\n\t\t\tthis._w = s * w + t * this._w;\r\n\t\t\tthis._x = s * x + t * this._x;\r\n\t\t\tthis._y = s * y + t * this._y;\r\n\t\t\tthis._z = s * z + t * this._z;\r\n\r\n\t\t\tthis.normalize();\r\n\t\t\tthis._onChangeCallback();\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar sinHalfTheta = Math.sqrt(sqrSinHalfTheta);\r\n\t\tvar halfTheta = Math.atan2(sinHalfTheta, cosHalfTheta);\r\n\t\tvar ratioA = Math.sin((1 - t) * halfTheta) / sinHalfTheta,\r\n\t\t\tratioB = Math.sin(t * halfTheta) / sinHalfTheta;\r\n\r\n\t\tthis._w = w * ratioA + this._w * ratioB;\r\n\t\tthis._x = x * ratioA + this._x * ratioB;\r\n\t\tthis._y = y * ratioA + this._y * ratioB;\r\n\t\tthis._z = z * ratioA + this._z * ratioB;\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tequals: function(quaternion) {\r\n\t\treturn (\r\n\t\t\tquaternion._x === this._x &&\r\n\t\t\tquaternion._y === this._y &&\r\n\t\t\tquaternion._z === this._z &&\r\n\t\t\tquaternion._w === this._w\r\n\t\t);\r\n\t},\r\n\r\n\tfromArray: function(array, offset) {\r\n\t\tif (offset === undefined) offset = 0;\r\n\r\n\t\tthis._x = array[offset];\r\n\t\tthis._y = array[offset + 1];\r\n\t\tthis._z = array[offset + 2];\r\n\t\tthis._w = array[offset + 3];\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\ttoArray: function(array, offset) {\r\n\t\tif (array === undefined) array = [];\r\n\t\tif (offset === undefined) offset = 0;\r\n\r\n\t\tarray[offset] = this._x;\r\n\t\tarray[offset + 1] = this._y;\r\n\t\tarray[offset + 2] = this._z;\r\n\t\tarray[offset + 3] = this._w;\r\n\r\n\t\treturn array;\r\n\t},\r\n\r\n\t_onChange: function(callback) {\r\n\t\tthis._onChangeCallback = callback;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_onChangeCallback: function() {}\r\n});\r\n\r\nexport { Quaternion };\r\n","import { GeoMath, GeoUtil } from \"./GeoMath\";\r\n\r\nexport class BrightnessProvider {\r\n\tprivate callback: (luxProvider: BrightnessProvider) => void;\r\n\r\n\tprivate illuminance: number = 0;\r\n\tprivate avalible: boolean = false;\r\n\r\n\tconstructor(params: { callback: (luxProvider: BrightnessProvider) => void }) {\r\n\t\tthis.callback = GeoUtil.setDefault<(luxProvider: BrightnessProvider) => void>(\r\n\t\t\tparams.callback,\r\n\t\t\tluxProvider => undefined\r\n\t\t);\r\n\r\n\t\tif (\"AmbientLightSensor\" in window && \"permissions\" in (navigator as any)) {\r\n\t\t\t(navigator as any).permissions\r\n\t\t\t\t.query({ name: \"ambient-light-sensor\" })\r\n\t\t\t\t.then((result: { state: string }) => {\r\n\t\t\t\t\tif (result.state === \"denied\") {\r\n\t\t\t\t\t\tconsole.info(\"Permission to use ambient light sensor is denied.\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tconst sensor = new AmbientLightSensor();\r\n\t\t\t\t\tsensor.onerror = (error: any) => this.onSensorError(error, console.info);\r\n\r\n\t\t\t\t\tsensor.onreading = () => {\r\n\t\t\t\t\t\tthis.illuminance = sensor.illuminance;\r\n\t\t\t\t\t\tthis.avalible = true;\r\n\t\t\t\t\t\tthis.callback(this);\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tsensor.start();\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.avalible = false;\r\n\t\t\tconsole.info(\"Sensor is not supported by the User Agent.\");\r\n\t\t}\r\n\t}\r\n\r\n\tpublic isAvalible() {\r\n\t\treturn this.avalible;\r\n\t}\r\n\r\n\tpublic getIlluminance() {\r\n\t\treturn this.illuminance;\r\n\t}\r\n\r\n\tpublic getBrightness() {\r\n\t\treturn GeoMath.limit(Math.log(this.illuminance + 1) / Math.LN10 / 5.0, 0, 1);\r\n\t}\r\n\r\n\tpublic getLightPower(multiply: number = 1) {\r\n\t\treturn 4 * GeoMath.PI * this.getBrightness() * multiply;\r\n\t}\r\n\r\n\tprivate onSensorError(event: any, onError: (error: string | Error) => void) {\r\n\t\t// Add SecurityError/feature policy error https://developer.mozilla.org/en-US/docs/Web/API/Sensor_APIs\r\n\t\tswitch (event.error.name) {\r\n\t\t\tcase \"NotAllowedError\":\r\n\t\t\t\tonError(\"You need to request permission for the ambientlightsensor first\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"NotReadableError\":\r\n\t\t\t\tonError(\"Cannot connect to the ambientlightsensor sensor\");\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow event.error; // Error message when the error is unknown\r\n\t\t}\r\n\t}\r\n}\r\n"],"sourceRoot":""}