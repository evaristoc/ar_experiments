<!DOCTYPE html>
<html>
  <head>
  <title>Testing WebAR session</title>    
	<meta>
	<script>
		  // WebXR requires HTTPS, so the site doesn't work if someone manually enters
		  // the URL and ends up using HTTP. To work around this, force redirect from
		  // http to https for non-localhost addresses.
		  if (window.location.protocol == "http:" &&
			  window.location.hostname != "localhost" && 
			  window.location.hostname != "127.0.0.1" &&
			  window.location.hostname != "[::1]") {
			window.location = window.location.href.replace('http:', 'https:');        
		  }
		</script>  
	</meta>
  </head>
  <body>
	<div id="log" style="background-color:orange; color:white; font-weight: bold; font-size: large; width:400px; height: 500px; z-index:100;">
	    <p id="modified"></p>
		<p id="p1"></p>
		<p id="p2"></p>
		<p id="p3"></p>
		<p id="p4"></p>
		<p id="p5"></p>
	</div>
	<button id="btn" style="z-index:200; position:absolute;bottom:20px;left:100px;"></button>		
	<script>
	  		const lastModifiedDate = new Date(document.lastModified);
		    document.getElementById("modified").textContent = lastModifiedDate;
	//--->>> https://web.dev/web-ar/
	//--->>> https://developer.mozilla.org/en-US/docs/Web/API/XRReferenceSpace#Reference_space_types
	//--->>> https://github.com/immersive-web/webxr/blob/master/spatial-tracking-explainer.md
			//navigator.xr;
			var xrButton = document.getElementById("btn");
			navigator.xr.isSessionSupported('immersive-ar').then((isSupported)=>{
			  //let xrButton = document.getElementsByTagName("button")[0];
			  if (isSupported) {
				//code
				alert("immersive-ar supported "+ lastModifiedDate);
				let onButtonClicked = function(){
				  navigator.xr.requestSession("immersive-ar")
					  .then((session)=>{
						xrSession = session;
						xrSession.isImmersive = true;
						//document.getElementById("p1").textContent = Object.keys(window.XRSpace);
						xrSession.requestReferenceSpace("local-floor").then((refSpace)=>{document.getElementById("p1").textContent = refSpace});
						
						xrButton.textContent = 'Exit AR';
						//alert("session successfully opened");
					  }).catch((err)=>{alert("error opening session")})			  
				};
				xrButton.addEventListener('click', onButtonClicked);
				xrButton.textContent = 'Enter AR';
				xrButton.enabled = isSupported; // supported is Boolean
			
			
			  }
			}).catch((err)=>{alert("error ocurred when confirming ar")});
			
			let xrSession = null;
			function onButtonClicked() {
				if (!xrSession) {
					navigator.xr.requestSession("immersive-ar")
									.then((session)=>{
									  xrSession = session;
									  xrSession.isImmersive = true;
									  xrButton.textContent = 'Exit AR';
									  //alert("session successfully opened");
									}).catch((err)=>{alert("error opening session")})
				}else{
				  //xrSession.end();
				  return
				}
			}
	</script>
  </body>
</html>